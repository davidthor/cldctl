---
title: "Component Configuration"
description: "Configure components within environments"
---

# Component Configuration

Each component in an environment can be configured with variables, scaling rules, route hostnames, and more.

## Basic Structure

Each component uses either `path` (for local directories) or `image` (for OCI registry references). These two properties are mutually exclusive.

```yaml
components:
  # OCI component - uses image reference
  web-app:
    image: ghcr.io/myorg/web-app:v1.0.0
    variables: { ... }
    scaling: { ... }
    functions: { ... }
    environment: { ... }
    routes: { ... }

  # Local component - uses path to local directory
  my-local-app:
    path: ./path/to/component
    variables: { ... }
```

## Component Source

### OCI Image

Reference a pre-built component artifact using the `image` field:

```yaml
components:
  web-app:
    image: ghcr.io/myorg/my-app:v1.0.0
```

### Local Path

For development, use the `path` field to point to a local component directory:

```yaml
components:
  my-app:
    path: ./services/my-app
```

Paths are resolved relative to the environment file's directory. When using a local path, cldctl invokes the datacenter's `dockerBuild` hook to build images.

<Warning>
  `path` and `image` are mutually exclusive. Setting both on the same component is a validation error.
</Warning>

## Variables

Pass values to component variables:

```yaml
components:
  web-app:
    image: ghcr.io/org/my-app:v1.0.0
    variables:
      log_level: "info"
      api_key: ${{ locals.api_key }}
      feature_flags: "new-ui,dark-mode"
```

Variables defined in the component's `cloud.component.yml` are resolved with these values at deployment time.

## Port Overrides

Pin specific port numbers for a component's dynamic ports:

```yaml
components:
  web-app:
    image: ghcr.io/org/my-app:v1.0.0
    ports:
      api: 3000
      admin: 3001
```

Port overrides take the highest priority in port allocation, overriding both datacenter hooks and the built-in deterministic allocator. This is useful for local development or when specific ports are required by infrastructure.

## Environment Variable Overrides

Add or override environment variables for specific deployments:

```yaml
components:
  web-app:
    image: ghcr.io/org/my-app:v1.0.0
    environment:
      api:                      # Deployment name
        FEATURE_FLAG: "true"
        DEBUG_MODE: "enabled"
      worker:
        BATCH_SIZE: "100"
```

This is useful for environment-specific configuration that shouldn't be in the component definition.

## Complete Example

```yaml
name: staging
datacenter: aws-production

locals:
  stripe_key: "sk_test_abc123"
  log_level: "debug"

components:
  auth:
    image: ghcr.io/myorg/auth:v2.1.0
    variables:
      jwt_secret: ${{ locals.jwt_secret }}
      log_level: ${{ locals.log_level }}

  web-app:
    image: ghcr.io/myorg/web-app:v1.5.0
    variables:
      stripe_key: ${{ locals.stripe_key }}
      log_level: ${{ locals.log_level }}
    environment:
      frontend:
        NEXT_PUBLIC_API_URL: https://api.staging.example.com

  worker:
    image: ghcr.io/myorg/worker:v1.2.0
    variables:
      log_level: "info"  # Override for this component
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Scaling" icon="expand" href="/environments/scaling">
    Configure replicas and resources
  </Card>
  <Card title="Routes" icon="route" href="/environments/routes">
    Configure hostnames and TLS
  </Card>
</CardGroup>
